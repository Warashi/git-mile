# TUI 要件

## 機能要件

- list/show 系コマンドの閲覧体験を提供し、CLI と同等のフィルタ・ソート・ページングオプションを扱えること。
- コメントやラベルなど CLI `--json` 出力で得られる情報をカード形式で表示し、必要に応じて詳細ビューへ遷移できること。
- 検索フィルタをプリセットとして保存し、起動時に再利用できること（将来的な拡張も見据えて設計する）。
- 失敗したリクエストは MCP エラー情報をユーザーに提示し、同じ入力で再送できること。

## 非機能要件

- 起動から初回 `initialize` 完了まで 2 秒以内（ローカルリポジトリ・デバッグビルド想定）。
- リスト描画は 60fps までは不要だが、入力反応が 150ms 以内になるようイベントループを調整する。
- UTF-8 全角・結合文字に対応し、幅計算のため `unicode-width` や `crossterm` の描画 API を利用する。
- ログ出力は `RUST_LOG=info` / `debug` に連動させ、`~/.cache/git-mile/tui.log` にリングバッファ形式で保存する。

## 接続要件

- `git mile mcp-server` を子プロセスとして起動するモードと、既存プロセスへ stdio リダイレクトで接続するモードを提供する。
- 子プロセスモードでは `GIT_MILE_MCP_BIN`（デフォルト: `git mile mcp-server`）を参照し、必要な CLI フラグを付与する。
- 既存プロセス接続ではサーバーが `initialize` 後に capability を広告する想定で、未対応メソッドは UI で無効化する。
- どちらのモードも単一接続を前提とし、接続断時は UI が再接続プロンプトを表示する。

## 共通化ポリシー

- MCP パラメータ変換は CLI と共有の `ListArgs` / `ShowArgs`（Serde 対応済み）を再利用し、分岐コードを持たない。
- 表示テキストは CLI ドキュメントと同じ用語集を参照し、翻訳・国際化は後続タスクで扱う。
- エラーコードは MCP `ErrorData` を UI メッセージへマップするテーブルを `git-mile-tui` クレート内に保持する。

## テレメトリ / 設定

- ユーザー設定ファイル `~/.config/git-mile/tui.toml` を想定し、MCP エンドポイント・配色・キーバインドを記録する。
- セッションメトリクス（リクエスト数、失敗数、平均レイテンシ）は `metrics` クレートで収集し、将来の観測に備える。
- ロールバックやバッチ編集など高リスク操作は TUI MVP では非対応とし、後続タスクで拡張する。
